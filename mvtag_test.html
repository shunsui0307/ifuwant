<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>クイックコール GTMテスト</title>
</head>
<body>

    <h1>クイックコールHTMLタグ テスト</h1>


<script>
!function() {
    // ----------------------------------------------------
    // ステップ1: URLパラメータの取得と定義
    // ----------------------------------------------------
    const urlParams = new URLSearchParams(window.location.search);
    const branch = urlParams.get('branch');
    const phoneNumber = urlParams.get('utm_customid');

    // ----------------------------------------------------
    // ステップ2: 支店ごとの設定を定義
    // ----------------------------------------------------
    const branchSettings = {
        'nagoya': {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjYW1wYWlnblVpZCI6ImIzZTFjNTgyLTZmYjAtNDgzNy1hMTE2LTRlMjhkODgxZWY3MiIsImlhdCI6MTc1ODY5MzI1Nn0.7ocR406IeYOVpT9HeWILRGxfNcXVXaE4AdV8qQA8ptQ",
            // 名古屋は4つのカスタムパラメータ
            customParams: {
                "ライン": "lineid_nagoya",
                "氏名(ｶﾅ)": "ダミーカナ",
                "氏名(漢字)": "ダミー漢字",
                "ｽﾀｯﾌ番号": 1
            }
        },
        'utsunomiya': {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjYW1wYWlnblVpZCI6ImViOTBjNmQ2LTJiNDMtNDE5Ni05Y2EyLTE1ZDgwNDVkNmYzMyIsImlhdCI6MTc1ODY5MzI5MX0.YLrHMZBWx_z_zllZWVk6SJ9XYwf5zR-3hTplO6AjXmA",
            // 宇都宮は6つのカスタムパラメータ
            customParams: {
                "ライン": "lineid_utsunomiya",
                "年齢": "99",
                "氏名(ｶﾅ)": "ダミーカナ",
                "氏名(漢字)": "ダミー漢字",
                "ｽﾀｯﾌ番号": 1,
                "登録日": "2025-09-29"
            }
        },
        // 以下の支店は宇都宮と同じカスタムパラメータ構成
        'osaka': {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjYW1wYWlnblVpZCI6ImM0NGMyODg4LWJmZDUtNGUzZC1iM2MwLTg1MWIyNmM5YThmMiIsImlhdCI6MTc1ODY5MzMxOX0.-alHbDu3sA-g_wVYaAsL0DnhG5siRbVAg7AW_VPmcoY",
            customParams: {
                "ライン": "lineid_osaka", "年齢": "99", "氏名(ｶﾅ)": "ダミーカナ", "氏名(漢字)": "ダミー漢字", "ｽﾀｯﾌ番号": 1, "登録日": "2025-09-29"
            }
        },
        'hachioji': {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjYW1wYWlnblVpZCI6ImE3ZDQxY2Q2LWY3MzgtNGY4OC1hZWVkLTA4M2VjNDkzZWExYyIsImlhdCI6MTc1ODY5MzM0NH0.G2TDCXydcTpPI0GZxX49NPWgU861bpjc-Bzq019peaQ",
            customParams: {
                "ライン": "lineid_hachioji", "年齢": "99", "氏名(ｶﾅ)": "ダミーカナ", "氏名(漢字)": "ダミー漢字", "ｽﾀｯﾌ番号": 1, "登録日": "2025-09-29"
            }
        },
        'omiya': {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjYW1wYWlnblVpZCI6IjAxYzM5OThmLWYzZmMtNGFhNC1iNWNkLTQwMWNjNDcyMTc5MiIsImlhdCI6MTc1ODY5MzM2OX0.yHob9kbbrquabrcGg9W4I4PM6_KDHoF_Siy3TZp3nYo",
            customParams: {
                "ライン": "lineid_omiya", "年齢": "99", "氏名(ｶﾅ)": "ダミーカナ", "氏名(漢字)": "ダミー漢字", "ｽﾀｯﾌ番号": 1, "登録日": "2025-09-29"
            }
        },
        'chiba': {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjYW1wYWlnblVpZCI6IjA1NjU2OTU3LWFjOTEtNDQ0Ny1hYWIwLTE1Yzk2MzgxZmQ3ZiIsImlhdCI6MTc1ODY5MzQwMn0.3MGeNI_zpr49XaCHFKQqFsH4j06G3QyuCY-Zymn4fC4",
            customParams: {
                "ライン": "lineid_chiba", "年齢": "99", "氏名(ｶﾅ)": "ダミーカナ", "氏名(漢字)": "ダミー漢字", "ｽﾀｯﾌ番号": 1, "登録日": "2025-09-29"
            }
        },
        'tokyo': {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjYW1wYWlnblVpZCI6ImI3YjA5ZWRkLWM4MjAtNGU3Ny1hMTJlLTI0MzQwZDMyZmExZSIsImlhdCI6MTc1ODY5MzQzNH0.YVJo46gcMiU7PojZxP60hmYAtovuLm7-jMfCfr8YVz8",
            customParams: {
                "ライン": "lineid_tokyo", "年齢": "99", "氏名(ｶﾅ)": "ダミーカナ", "氏名(漢字)": "ダミー漢字", "ｽﾀｯﾌ番号": 1, "登録日": "2025-09-29"
            }
        },
    };

    const setting = branchSettings[branch];

    // ----------------------------------------------------
    // ステップ3: タグ本体の読み込みと mvtag の定義
    // ----------------------------------------------------
    if (setting) {
        // タグ本体の読み込み
        const script = document.createElement("script");
        script.src = "https://api.micovoice.com/api/v1/quick_calls/tag";
        script.async = true;
        script.type = "text/javascript";
        document.head.appendChild(script);

        // mvtag関数の定義
        window.__MV_DATALAYER__ = window.__MV_DATALAYER__ || [];
        window.mvtag = function(e, t) {
            __MV_DATALAYER__.push({
                eventType: e,
                eventData: t,
                token: setting.token // 選択された支店のトークンを使用
            });
        };
    } else {
        console.warn("クイックコール: 有効な branch パラメータが見つからなかったため、タグは読み込まれませんでした。");
    }

    // ----------------------------------------------------
    // ステップ4: 電話番号パラメータが存在する場合、mvtagを発火
    // ----------------------------------------------------
    if (phoneNumber && setting) {
        
        // タグ本体の読み込み完了を待つための遅延
        setTimeout(() => {
            if (window.mvtag) {
                // mvtag関数を呼び出し
                window.mvtag("quick_call", {
                    "is_sandbox": false, // 本番稼働時は false
                    "phone_number": phoneNumber, // URLパラメータの値

                    // 支店ごとに内容が異なるカスタムパラメータ
                    "custom_parameters": setting.customParams 
                });
            } else {
                console.error("クイックコール: mvtag関数が定義されていません。");
            }
        }, 1000); 
    }
}();
</script>

</body>
</html>
